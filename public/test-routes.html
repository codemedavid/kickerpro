<!DOCTYPE html>
<html>
<head>
    <title>Test AI Routes - Cache Bypass</title>
</head>
<body>
    <h1>AI Routes Cache Bypass Test</h1>
    <p>This bypasses browser cache to test routes directly</p>
    
    <button onclick="testScoreLeads()">Test Score Leads</button>
    <button onclick="testAutoCreate()">Test Auto-Create</button>
    <button onclick="testClassify()">Test Classify Stage</button>
    
    <pre id="output" style="background: #f5f5f5; padding: 20px; margin-top: 20px;"></pre>

    <script>
        function log(msg) {
            document.getElementById('output').textContent += msg + '\n';
        }

        async function testScoreLeads() {
            log('\nüß™ Testing /api/ai/score-leads...');
            try {
                const response = await fetch('/api/ai/score-leads?' + Date.now(), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache'
                    },
                    cache: 'no-store',
                    body: JSON.stringify({
                        conversationIds: ['test'],
                        pageId: 'test'
                    })
                });
                
                log('Status: ' + response.status + ' ' + response.statusText);
                const data = await response.json();
                log('Response: ' + JSON.stringify(data, null, 2));
                
                if (response.status === 404) {
                    log('‚ùå ROUTE RETURNS 404 - File may not be deployed');
                } else if (response.status === 401) {
                    log('‚úÖ ROUTE WORKS! Just needs authentication');
                } else {
                    log('‚úÖ ROUTE RESPONDS!');
                }
            } catch (error) {
                log('Error: ' + error.message);
            }
        }

        async function testAutoCreate() {
            log('\nüß™ Testing /api/ai/auto-create-opportunities...');
            try {
                const response = await fetch('/api/ai/auto-create-opportunities?' + Date.now(), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache'
                    },
                    cache: 'no-store',
                    body: JSON.stringify({
                        conversationIds: ['test'],
                        pageId: 'test'
                    })
                });
                
                log('Status: ' + response.status + ' ' + response.statusText);
                const data = await response.json();
                log('Response: ' + JSON.stringify(data, null, 2));
                
                if (response.status === 404) {
                    log('‚ùå ROUTE RETURNS 404 - File may not be deployed');
                } else if (response.status === 401) {
                    log('‚úÖ ROUTE WORKS! Just needs authentication');
                } else {
                    log('‚úÖ ROUTE RESPONDS!');
                }
            } catch (error) {
                log('Error: ' + error.message);
            }
        }

        async function testClassify() {
            log('\nüß™ Testing /api/ai/classify-stage...');
            try {
                const response = await fetch('/api/ai/classify-stage?' + Date.now(), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache'
                    },
                    cache: 'no-store',
                    body: JSON.stringify({
                        conversationIds: ['test'],
                        pageId: 'test'
                    })
                });
                
                log('Status: ' + response.status + ' ' + response.statusText);
                const data = await response.json();
                log('Response: ' + JSON.stringify(data, null, 2));
                
                if (response.status === 404) {
                    log('‚ùå ROUTE RETURNS 404 - File may not be deployed');
                } else if (response.status === 401) {
                    log('‚úÖ ROUTE WORKS! Just needs authentication');
                } else {
                    log('‚úÖ ROUTE RESPONDS!');
                }
            } catch (error) {
                log('Error: ' + error.message);
            }
        }

        log('üìç Current URL: ' + window.location.href);
        log('üïê Timestamp: ' + new Date().toISOString());
        log('\nClick a button above to test each route with cache bypass');
    </script>
</body>
</html>

